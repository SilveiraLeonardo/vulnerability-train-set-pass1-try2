
from pathlib import Path
import re

import click
import requests


def validate_username(username):
    if not re.match("^[A-Za-z0-9]*$", username) or len(username) > 20:
        raise ValueError("Invalid username")
    return username


def request_data(username, timeout):
    try:
        r = requests.get('https://127.0.1.1:5000/api/post/{}'.format(username), verify='/path/to/cert.pem', timeout=timeout)
        return r
    except requests.exceptions.RequestException as e:
        raise e


@click.command()
@click.argument('username')
def cmd_api_client(username):
    try:
        username = validate_username(username)
    except ValueError as e:
        click.echo("Error: {}".format(e))
        return False

    try:
        r = request_data(username, timeout=10)
    except requests.exceptions.RequestException as e:
        click.echo("Error: {}".format(e))
        return False
        
    if r.status_code != 200:
        click.echo('Some error occurred. Status Code: {}'.format(r.status_code))
        print(r.text)
        return False

    print(r.text)


if __name__ == '__main__':
    cmd_api_client()
