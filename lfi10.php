
<?php
session_start();

// Generate a CSRF token
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}

include("../common/header.php");
?>

<form action="/api/index.php" method="POST">
    <input type="text" name="file">
    <input type="hidden" name="csrf_token" value="<?php echo htmlspecialchars($_SESSION['csrf_token']); ?>">
    <button type="submit">Submit</button>
</form>

<?php
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['csrf_token']) && $_POST['csrf_token'] === $_SESSION['csrf_token']) {
    $file = $_POST['file'];
    $allowed_files = ['page1.php', 'page2.php', 'page3.php'];
    
    if (in_array($file, $allowed_files)) {
        include("pages/$file");
    } else {
        include("index.php");
    }
} else {
    include("index.php");
}
?>
