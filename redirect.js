
console.log("WIP");
const express = require("express");
const router = express.Router();

// Example white-listed paths
const whiteListedPaths = ["/path1", "/path2", "/path3"];
const whiteListedDomains = ["https://example.com"];

// User authentication middleware
function isAuthenticated(req, res, next) {
    if (req.session && req.session.isAuthenticated()) {
        return next();
    }
    return res.redirect("/");
}

router.get("/login", isAuthenticated, function (req, res) {
    let followPath = req.query.path;
    
    // Validate and sanitize the followPath
    if (whiteListedPaths.includes(followPath)) {
        res.redirect("http://example.com" + followPath);
    } else {
        res.redirect("/");
    }
});

router.get("/goto", function (req, res) {
    let url = req.query.url;
    
    // Check if the URL is in the white-listed domains
    let isValidRedirect = whiteListedDomains.some((domain) => url.startsWith(domain));
    
    if (isValidRedirect) {
        res.redirect(url);
    } else {
        res.redirect("/");
    }
});

module.exports = router;
