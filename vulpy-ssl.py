
#!/usr/bin/env python3

import os
from flask import Flask, g, redirect, request

from your_module_name import mod_hello, mod_user, mod_posts, mod_mfa
import libsession

app = Flask('vulpy')

app.config['SECRET_KEY'] = os.environ.get('SECRET_KEY')

app.register_blueprint(mod_hello, url_prefix='/hello')
app.register_blueprint(mod_user, url_prefix='/user')
app.register_blueprint(mod_posts, url_prefix='/posts')
app.register_blueprint(mod_mfa, url_prefix='/mfa')


@app.route('/')
def do_home():
    return redirect('/posts')

@app.before_request
def before_request():
    g.session = libsession.load(request)

DEBUG = os.environ.get("DEBUG") == "True"
CERT_FILE = os.environ.get("CERT_FILE", "/tmp/acme.cert")
KEY_FILE = os.environ.get("KEY_FILE", "/tmp/acme.key")

app.run(debug=DEBUG, host='127.0.1.1', ssl_context=(CERT_FILE, KEY_FILE))
