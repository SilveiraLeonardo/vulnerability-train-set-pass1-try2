
<?php
    include("../common/header.php");
    hint(htmlspecialchars("Improved safety measures have been implemented for text input fields.", ENT_QUOTES, 'UTF-8'));
?>

<form action="/CMD-5/index.php" method="POST">
    <input type="text" name="domain">
    <input type="hidden" name="server" value="whois.publicinterestregistry.net">
    <input type="submit" value="Submit">
</form>

<pre>
<?php
$domain = filter_input(INPUT_POST, "domain", FILTER_SANITIZE_STRING);
$server = filter_input(INPUT_POST, "server", FILTER_SANITIZE_STRING);

if (preg_match('/^[-a-z0-9]+\.a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvyz]|t[cdfghjklmnoprtvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]|biz|cat|com|edu|gov|int|mil|net|org|pro|tel|aero|arpa|asia|coop|info|jobs|mobi|name|museum|travel|arpa|xn--[a-z0-9]+$/', strtolower($domain))) {
    $server_escaped = escapeshellarg($server);
    $domain_escaped = escapeshellarg($domain);
    system("whois -h " . $server_escaped . " " . $domain_escaped);
} else {
    echo "malformed domain name";
}
?>
</pre>
