
<?php
session_start();

// Generate CSRF token
if (!isset($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}

// Validate and sanitize input, and include ("stylepath" has been removed)
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['csrf_token']) && $_POST['csrf_token'] == $_SESSION['csrf_token']) {
    $allowed_styles = ['style1.php', 'style2.php'];
    $style = in_array($_POST['style'], $allowed_styles) ? $_POST['style'] : 'default.php';
    include("../styles/" . $style);
} else {
    include('../styles/default.php');
}

include("../common/header.php");
?>

<form action="/api/index.php" method="POST">
    <input type="text" name="file" value="<?= htmlspecialchars($_POST['file'] ?? '', ENT_QUOTES, 'UTF-8'); ?>">
    <input type="hidden" name="style">
    <!-- Add CSRF token to the form -->
    <input type="hidden" name="csrf_token" value="<?= htmlspecialchars($_SESSION['csrf_token'], ENT_QUOTES, 'UTF-8'); ?>">
</form>

<?php include("../common/footer.php"); ?>
