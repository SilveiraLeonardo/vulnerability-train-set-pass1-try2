
using System;
using System.Net;
using System.Net.Sockets;
using System.Threading.Tasks;

// Other codes...

try
{
    int rPort;
    if (int.TryParse(Request.get_Item("remotePort"), out rPort) &&
       (rPort >= 1024 && rPort <= 65535))
    {
        IPEndPoint endpoint = new IPEndPoint(address, rPort);

        using (Socket socket = new Socket(endpoint.AddressFamily, SocketType.Stream, ProtocolType.Tcp))
        {
            socket.ReceiveTimeout = 5000; // 5 seconds
            socket.SendTimeout = 5000; // 5 seconds

            Task<bool> connectTask = socket.ConnectAsync(endpoint);
            if (await Task.WhenAny(connectTask, Task.Delay(5000)) != connectTask)
            {
                socket.Close();
                throw new TimeoutException("Connection timed out.");
            }

            // Continue with other operations after the socket is connected
        }
    }
    else
    {
        throw new ArgumentException("Invalid remote port number.");
    }
}
catch (SocketException e)
{
    // Handle socket-related error
}
catch (TimeoutException e)
{
    // Handle connection timeout error
}
catch (ArgumentException e)
{
    // Handle invalid argument error
}
catch (Exception e)
{
    // Handle other exceptions or log them
}
