
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<stdint.h>

#define BUFFER_SIZE 100

struct Image
{
	char header[5];
	int width;
	int height;
	char data[11];
};

void read_data(FILE *fp, void *buf, size_t size) {
  if(fread(buf, size, 1, fp) == 0) {
    printf("Error reading data.\n");
    exit(EXIT_FAILURE);
  }
}

int ProcessImage(char* filename){

	FILE *fp;
	struct Image img;

	fp = fopen(filename,"r"); 

	if(fp == NULL)
	{
		printf("\nCan't open file or file doesn't exist.");
		exit(0);
	}

	printf("\n\tHeader\twidth\theight\tdata\t\r\n");

	while(!feof(fp)) {
		read_data(fp, img.header, 4);
		read_data(fp, &img.width, sizeof(int));
		read_data(fp, &img.height, sizeof(int));
		read_data(fp, img.data, 10);

		img.header[4] = '\0';
		img.data[10] = '\0';

		const int max_width_height = 4096;
		if (img.width <= 0 || img.height <= 0 || img.width > max_width_height || img.height > max_width_height) {
		  printf("Invalid width or height values.\n");
		  continue;
		}

		printf("\n\t%s\t%d\t%d\t%s\r\n",img.header,img.width,img.height,img.data);

		int64_t size1 = img.width + img.height;
		char* buff1 = (char*)malloc(size1);

		if(buff1 == NULL) {
			printf("Memory allocation error\n");
			exit(EXIT_FAILURE);
		}

		memcpy(buff1, img.data, sizeof(img.data));
		free(buff1);

		int64_t size2 = img.width - img.height + 100;
		char* buff2 = (char*)malloc(size2);

		if(buff2 == NULL) {
			printf("Memory allocation error\n");
			exit(EXIT_FAILURE);
		}

		memcpy(buff2, img.data, sizeof(img.data));

		int64_t size3= img.width / img.height;
		int buff3_size = BUFFER_SIZE;
		char buff3[buff3_size];
		char* buff4 = (char*)malloc(size3);

		if(buff4 == NULL) {
			printf("Memory allocation error\n");
			exit(EXIT_FAILURE);
		}

		memcpy(buff4, img.data, sizeof(img.data));

		if(size3 + 100 < buff3_size) {
		  buff3[size3 + 100] = 'c';
		}
		if(100 < size3) {
		  buff4[100] = 'c';
		}

		if(size3 > 10) {
			buff4 = 0;
		}
		else {
			free(buff4);
		}

		free(buff2);
	}
	fclose(fp);
}

int main(int argc,char **argv)
{
	if(argc < 2) {
		printf("Usage: %s <filename>\n", argv[0]);
		exit(1);
	}
	ProcessImage(argv[1]);
}
