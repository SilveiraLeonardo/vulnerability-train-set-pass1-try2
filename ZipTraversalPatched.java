
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardCopyOption;
import java.util.Enumeration;
import java.util.zip.ZipEntry;
import java.util.zip.ZipFile;

public class ZipExtractor {

    public void extract(ZipFile zip) throws IOException {
        String toDir = "/my/target/directory/";
        Enumeration<? extends ZipEntry> entries = zip.entries();
        Path targetDirPath = Paths.get(toDir).toAbsolutePath().normalize();
    
        try {
            while (entries.hasMoreElements()) {
                ZipEntry zipEntry = entries.nextElement();
    
                Path filePath = targetDirPath.resolve(zipEntry.getName()).toAbsolutePath().normalize();
    
                if (!filePath.startsWith(targetDirPath)) {
                    throw new SecurityException("ZipEntry not within target directory!");
                }
    
                if (zipEntry.isDirectory()) {
                    Files.createDirectories(filePath);
                } else {
                    Path parentDir = filePath.getParent();
                    if (!Files.exists(parentDir)) {
                        Files.createDirectories(parentDir);
                    }
    
                    try (InputStream istr = zip.getInputStream(zipEntry)) {
                        Files.copy(istr, filePath, StandardCopyOption.REPLACE_EXISTING);
                    }
                }
            }
        } finally {
            zip.close();
        }
    }

    // You can add the necessary main method or use the extract method to test the code
}
