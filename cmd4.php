
<?php
    include("../common/header.php");
    session_start();

    function generate_csrf_token() {
        if (empty($_SESSION['csrf_token'])) {
            $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
        }
        return $_SESSION['csrf_token'];
    }

    function verify_csrf_token($token) {
        return !empty($_SESSION['csrf_token']) && hash_equals($_SESSION['csrf_token'], $token);
    }
?>

<?php hint("something something something placeholder placeholder placeholder"); ?>

<form action="/CMD-4/index.php" method="POST">
    <input type="text" name="domain">
    <input type="hidden" name="csrf_token" value="<?php echo htmlspecialchars(generate_csrf_token()); ?>">
    <input type="submit" value="Submit">
</form>

<pre>
<?php
    if ($_SERVER['REQUEST_METHOD'] == 'POST') {
        if (isset($_POST['csrf_token']) && verify_csrf_token($_POST['csrf_token'])) {
            $esc_domain = escapeshellarg($_POST['domain']);
            system("whois " . $esc_domain);
        } else {
            echo 'Invalid CSRF token.';
        }
    }
?>
</pre>
