
<?php
session_start();

// Generate a CSRF token if not present
if (!isset($_SESSION['CSRFToken'])) {
    $_SESSION['CSRFToken'] = bin2hex(random_bytes(32));
}
?>

<!DOCTYPE html>
<html>
<head>
    <?php include("../common/header.php"); ?>
</head>
<body>
    <form action="/api/index.php" method="POST">
        <input type="hidden" name="CSRFToken" value="<?php echo $_SESSION['CSRFToken']; ?>" />
        <input type="text" name="library">
        <input type="submit" value="Submit">
    </form>

    <?php
    // Check if both POST data and CSRF token are present
    if (isset($_POST['library'], $_POST['CSRFToken'])) {
        // Validate CSRF token
        if ($_SESSION['CSRFToken'] === $_POST['CSRFToken']) {
            $allowedLibraries = ['library1', 'library2', 'library3'];
            $library = $_POST['library'];

            // Validate library before including it 
            if (in_array($library, $allowedLibraries)) {
                include("includes/{$library}.php");
            } else {
                // Handle unauthorized library file request
                echo "<p>Unauthorized library file requested.</p>";
            }
        } else {
            // Handle invalid CSRFToken
            echo "<p>Invalid CSRF token.</p>";
        }
    }
    ?>
</body>
</html>
