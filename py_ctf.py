
import os
from flask import (
    Flask,
    render_template,
    request,
    url_for,
    redirect,
    session,
)
from flask_session import Session

app = Flask(__name__)

execfile('flag.py')
execfile('key.py')

FLAG = flag
app.secret_key = key

# Configure Flask-Session
app.config["SESSION_TYPE"] = "filesystem"
app.config["SESSION_USE_SIGNER"] = True
Session(app)


@app.route("/golem", methods=["GET", "POST"])
def golem():
    if request.method != "POST":
        return redirect(url_for("index"))

    golem = request.form.get("golem") or None

    if golem is not None:
        golem = golem.replace(".", "").replace(
            "_", "").replace("{", "").replace("}", "")

    if "golem" not in session or session['golem'] is None:
        session['golem'] = golem

    session['golem'] = None

    return render_template("golem_template.html", golem=golem)


@app.route("/", methods=["GET"])
def index():
    return render_template("main.html")


@app.route('/article', methods=['GET'])
def article():
    error = 0
    allowed_files = ["article", "notallowed.txt"]

    if 'name' in request.args:
        page = request.args.get('name')

        if page not in allowed_files:
            page = 'notallowed.txt'

    else:
        page = 'article'

    try:
        template = open('/home/golem/articles/{}'.format(page)).read()
    except Exception as e:
        template = e

    return render_template('article.html', template=template)

if __name__ == "__main__":
    app.run(host='0.0.0.0', debug=False)
